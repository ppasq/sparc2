{% extends "sparc2/maps/base.yml" %}

{% block title %}
title: SPARC - {{ country_title }} - {{ hazard_title }}
{% endblock %}

{% block legend %}
legend:
  position: { top: auto, right: 8px, bottom: 80px, left: auto }
  width: 425px
  height: auto
  grid: ["col-sm-4", "col-sm-8"]
  font: { family: FontAwesome, size: 1.2rem }
  css:
    properties:
      - { name: padding, value: 0.5em }
      - { name: background, value: '#FFF' }
      - { name: border-top, value: '4px solid #2A93FC' }
      - { name: border-radius, value: '0' }
      - { name: line-height, value: '20px' }
      - { name: color, value: '#404040' }
{% endblock %}

{% block view %}
view:
  lat: 0
  lon: 0
  zoom: 3
  minZoom: 0
  maxZoom: 18
  baselayer: "mapbox.light"
  featurelayers: [ "popatrisk" ]
  controls: [ "legend" ]
{% endblock %}

{% block overlays %}
overlays:
  - id: zoom_in
    type: text
    title: "Zoom In"
    position: { top: 8px, left: 8px, bottom: auto, right: auto }
    text:
      content: ""
      font: { family: FontAwesome, size: 1.2rem }
    intent:
      name: zoomIn
    tooltip: { placement: right, content: "Zoom In" }
    css: {% include "sparc2/_includes/dashboard/intent/css.yml" %}
  - id: zoom_out
    type: text
    title: "Zoom Out"
    position: { top: calc(8px + 10px + 1.2rem + 10px), left: 8px, bottom: auto, right: auto }
    text:
      content: ""
      font:
        family: FontAwesome
        size: 1.2rem
    intent:
      name: zoomOut
    tooltip: { placement: right, content: "Zoom Out" }
    css: {% include "sparc2/_includes/dashboard/intent/css.yml" %}
  - id: reset_extent
    type: text
    title: "Reset Extent"
    position: { top: calc(8px + 10px + 1.2rem + 10px + 8px + 10px + 1.2rem + 10px), left: 8px, bottom: auto, right: auto }
    text:
      content: ""
      font: { family: FontAwesome, size: 1.2rem }
    intent:
      name: flyToExtent
      properties: [{ name: extent, value: "initial" }]
    tooltip: { placement: right, content: "Reset Extent" }
    css: {% include "sparc2/_includes/dashboard/intent/css.yml" %}
  - id: toggle_fullscreen
    type: text
    title: "Toggle Full Screen"
    position: { top: 0.8rem, left: auto, bottom: auto, right: 0.8rem }
    text:
      content: ""
      font: { family: FontAwesome, size: 1.2rem }
    intent: { name: toggleFullScreen }
    tooltip: { placement: left, content: "Toggle Full Screen" }
    css: {% include "sparc2/_includes/dashboard/intent/css.yml" %}
  - id: print_map
    type: text
    title: "Print Map"
    position: { top: calc(0.8rem + 10px + 1.2rem + 10px + 0.8rem), left: auto, bottom: auto, right: 0.8rem }
    text:
      content: ""
      font: { family: FontAwesome, size: 1.2rem }
    intent:
      name: printMap
    tooltip: { placement: left, content: "Print Map" }
    css: {% include "sparc2/_includes/dashboard/intent/css.yml" %}
  - id: toggle_legend
    type: text
    title: "Toggle Legend"
    position: { top: calc(8px + 10px + 1.2rem + 10px + 8px + 10px + 1.2rem + 10px + 8px + 10px + 1.2rem + 10px + 8px), left: 8px, bottom: auto, right: auto }
    text:
      content: ""
      font:
        family: FontAwesome
        size: 1.2rem
    intent:
      name: toggleControl
      properties: [{ name: control, value: legend }]
    tooltip: { placement: right, content: "Toggle Legend" }
    css: {% include "sparc2/_includes/dashboard/intent/css.yml" %}
  - id: submit_issue
    type: text
    title: "Feedback"
    position: { top: calc(8px + 10px + 1.2rem + 10px + 8px + 10px + 1.2rem + 10px + 8px + 10px + 1.2rem + 10px + 8px + 10px + 1.2rem + 10px + 8px), left: 8px, bottom: auto, right: auto }
    text:
      content: ""
      font: { family: FontAwesome, size: 1.2rem }
    link:
      url: "https://docs.google.com/forms/d/e/1FAIpQLSfgmXj6lVIfaZcWxkxGX-4DGqv6Twq1RSvGB0PR5UhxryEkXA/viewform"
      target: "_blank"
    tooltip: { placement: right, content: "Feedback" }
    css: {% include "sparc2/_includes/dashboard/intent/css.yml" %}
{% endblock %}

{% block baselayers %}{{ block.super }}{% endblock %}

{% block featurelayers %}{% verbatim %}
featurelayers:
  - id: popatrisk
    type: geojson
    title: "Population at Risk"
    description: "Population at Risk"
    source: {% endverbatim %}{% include "sparc2/_includes/dashboard/layer/source.yml" %}{% verbatim %}
    geojson: { url: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/{% endverbatim %}{{ hazard }}{% verbatim %}/dataset/popatrisk/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_PopAtRisk_{% endverbatim %}{{ hazard | title }}{% verbatim %}.json" }
    legend: { ui: { source: false } }
    download:
      links:
        - type: api
          format: json
          title: GeoJSON
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/{% endverbatim %}{{ hazard }}{% verbatim %}/dataset/popatrisk/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_PopAtRisk_{% endverbatim %}{{ hazard | title }}{% verbatim %}.json"
          tooltip: { title: "API for systems integration.  Can be used with QGIS." }
        - type: api
          format: yaml
          title: YAML
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/{% endverbatim %}{{ hazard }}{% verbatim %}/dataset/popatrisk/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_PopAtRisk_{% endverbatim %}{{ hazard | title }}{% verbatim %}.yml"
          tooltip: { title: "Useful for reading." }
        - type: export_month
          format: csv
          title: CSV
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/{% endverbatim %}{{ hazard }}{% verbatim %}/dataset/popatrisk/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_PopAtRisk_{% endverbatim %}{{ hazard | title }}{% verbatim %}_{{ state.month | formatMonth: 'short3' | title }}.csv"
          tooltip: { title: "Can be used with Microsoft Excel." }
        - type: export_month
          format: zipped_shapefile
          title: "Zipped Shapefile"
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/{% endverbatim %}{{ hazard }}{% verbatim %}/dataset/popatrisk/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_PopAtRisk_{% endverbatim %}{{ hazard | title }}{% verbatim %}_{{ state.month | formatMonth: 'short3' | title }}.zip"
          tooltip: { title: "Can be use with GIS systems, e.g., GeoNode, ArcMap, and QGIS." }
    carto:
      styles:
        - id: default
          title: Default Style
          description: "For a given hazard, month, and admin 2, the population at risk."
          legend: { type: graduated }
          symbolizers:
            - id: default
              title: Default Symbolizer
              description: "For a given hazard, month, and admin 2, the population at risk."
              type: polygon
              metadata:
                range: [{ label: "| Low Population at Risk" }, { label: "High Population at Risk |" }]
              static:
                properties:
                  fillColor: "#000000"
                  fillOpacity: 0.6
                  strokeWidth: 0.2
                  strokeColor: "#000000"
              dynamic:
                func: {% endverbatim %}"{{ hazard }}"{% verbatim %}
                options:
                  colors:
                    ramp:
                      - '#ffffe0'
                      - '#ffd59b'
                      - '#ffa474'
                      - '#f47461'
                      - '#db4551'
                      - '#b81b34'
                      - '#8b0000'
                  breakpoints: "popatrisk_natural_adjusted"
                  filters: ["vam_filter_fcs", "vam_filter_csi"]
  {% endverbatim %}{% if hazard == "cyclone" %}{% verbatim %}
    description: "The population at risk of cyclone for each month aggregated at the administrative level 2 district. Cyclone Population risk calculated considering historical storm occurrence disaggregated by monthly weights from ibTRACS (UNEP GRID version) and crossed with population presence (Landscan)."
    popup:
      title: "Population at Risk: {{ feature.attributes.admin2_name }}, {{ feature.attributes.admin1_name }}"
      maxWidth: 550
      panes:
        - id: "popup_overview"
          tab: { label: "Overview" }
          fields:
            - value: "{{ popatrisk('cyclone', feature, state, filters) | formatInteger : 'delimited' : ' ' }}"
              label: "Population at Risk for {{ state.month | formatMonth: 'long' }}"
          charts:
            - id: "sparc-popup-chart-popatrisk"
              title: "Population at Risk for {{ feature.attributes.admin2_name }} by Month"
              type: "bar"
              axis:
                x:
                  type: "months"
                y:
                  label:
                    text: 'Pop at Risk'
                    position: 'outer-middle'
              hazard: cyclone
              colors:
                0-10%: "#00a878"
                10-20%: "#61b374"
                20-30%: "#8ebe6f"
                30-40%: "#b4c96a"
                40-50%: "#d9d364"
                50-60%: "#ffc45b"
                60-70%: "#ffac59"
                70-80%: "#ff9257"
                80-90%: "#ff7655"
                90-100%: "#ff5252"
              tooltip: { value: cyclone_value }
        - id: "popup_location"
          tab: { label: "Location" }
          fields:
            - attribute: iso_alpha3
              label: ISO Alpha-3 Country Code
            - value: "{{ feature.attributes.admin0_name }}"
              label: Admin 0
            - value: "{{ feature.attributes.admin1_name }}"
              label: Admin 1
            - value: "{{ feature.attributes.admin2_name }}"
              label: Admin 2
        #- id: "popup_vam_fcs"
        #  tab: { label: "FCS" }
        #  fields:
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.month') | formatMonth : 'long' }} {{ vam(feature.attributes.admin1_code,'fcs.year') }}"
        #      label: VAM FCS Date
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.source') }}"
        #      label: VAM FCS Source
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.poor') | formatFloat: 2 }}"
        #      label: VAM FCS Poor
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.borderline') | formatFloat: 2 }}"
        #      label: VAM FCS Borderline
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.acceptable') | formatFloat: 2 }}"
        #      label: VAM FCS Acceptable
        #- id: "popup_vam_csi"
        #  tab: { label: "CSI" }
        #  fields:
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.month') | formatMonth : 'long' }} {{ vam(feature.attributes.admin1_code,'csi.year') }}"
        #      label: VAM CSI Date
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.source') }}"
        #      label: VAM CSI Source
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.no') | formatFloat: 2 }}"
        #      label: VAM CSI No
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.low') | formatFloat: 2 }}"
        #      label: VAM CSI Low
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.medium') | formatFloat: 2 }}"
        #      label: VAM CSI Medium
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.high') | formatFloat: 2 }}"
        #      label: VAM CSI high
        - id: "popup_context"
          tab: { label: "Context" }
          fields:
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code,'ldi')  }}"
              label: LDI
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_mean') | formatFloat: 2 | add : '%' }}"
              label: Mean Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_positive') | formatFloat: 2 | add : '%' }}"
              label: Positive Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_negative') | formatFloat: 2 | add : '%' }}"
              label: Negative Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_forest') | formatFloat: 2 | add : '%' }}"
              label: Forest Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_crop') | formatFloat: 2 | add : '%' }}"
              label: Crop Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'erosion_propensity') | formatFloat: 1 | add : '%'  }}"
              label: Erosion Propensity
    filters:
      - layer: popatrisk
        output: popatrisk_range
        title: "Pop at Risk"
        description:  "The population at risk at the admin-2 level."
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-popatrisk-slider
            type: continuous
            width: 100px
            range: true  # See https://jqueryui.com/slider/#range
            label: "{{ values[0] | formatInteger:'delimited':' ' }} - {{ values[1] | formatInteger:'delimited':' ' }}"
            values: [0, {% endverbatim %}{{ maxValue }}{% verbatim %}]
            min: 0
            max: summary  # Overridden by max value from summary data
            step: 1
      - layer: popatrisk
        title: Category
        output: category
        description: "The Saffir-Simpson Hurricane Wind Scale is a 1 to 5 rating based on a hurricane's sustained wind speed. This scale estimates potential property damage. Hurricanes reaching Category 3 and higher are considered major hurricanes because of their potential for significant loss of life and damage. Category 1 and 2 storms are still dangerous, however, and require preventative measures. In the western North Pacific, the term \"super typhoon\" is used for tropical cyclones with sustained winds exceeding 150 mph."
        height: 34px
        type: radio
        radio:
          options:
            - id: "sparc-cat1_5"
              name: "cat"
              value: "cat1_5"
              label: "1-5"
              description: "All Categories for cyclones, typhoons, and hurricanes."
              checked: true
            - id: "sparc-cat1_3"
              name: "cat"
              value: "cat1_3"
              label: "1-3"
              description: "Only categories 1 through 3 for cyclones, typhoons, and hurricanes."
            - id: "sparc-cat4_5"
              name: "cat"
              value: "cat4_5"
              label: "4-5"
              description: "Only category 4 and 5 for cyclones, typhoons, and hurricanes."
      - layer: popatrisk
        output: prob_class_max
        title: "Probability"
        description:  "The probability by admin2-month that a cyclone will hit."
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-probabilities-slider
            type: continuous
            width: 120px
            range: max
            label: "{{ value }} - 1.0"
            value: 0.1
            min: 0
            max: 1.0
            step: 0.1
      - layer: popatrisk
        output: fcs
        title: FCS
        description: "Filter by VAM Food Consumption Score (FCS).\n\nReference: [http://documents.wfp.org/stellent/groups/public/documents/manual_guide_proced/wfp197216.pdf](http://documents.wfp.org/stellent/groups/public/documents/manual_guide_proced/wfp197216.pdf)"
        height: 34px
        type: checkbox
        checkbox:
          options:
            - id: "sparc-poor"
              value: "poor"
              label: "Poor"
              description: "Food Consumption Score (FCS) from 0 to 21.  This means a household is expected NOT to eat at least staple and vegetables on a daily base and therefore considered to have poor food consumption.  The value 21 comes from an expected daily consumption of staple (frequency * weight, 7 * 2 = 14) and vegetables (7 * 1 = 7)."
              checked: true
            - id: "sparc-borderline"
              value: "borderline"
              label: "Borderline"
              description: "Food Consumption Score (FCS) from 21.5 to 35.  This means households are assessed having borderline food consumption.  The value 35 comes from an expected daily consumption of staple and vegetables complemented by a frequent (4 day/week) consumption of oil and pulses (staple*weight + vegetables*weight + oil*weight + pulses*weight = 7*2+7*1+4*0.5+4*3=35)."
              checked: true
            - id: "sparc-acceptable"
              value: "acceptable"
              label: "Acceptable"
              description: "Food Consumption Score (FCS) greater than 35.  This means households that score above 35 are estimated having acceptable food consumption.  The value 35 comes from an expected daily consumption of staple and vegetables complemented by a frequent (4 day/week) consumption of oil and pulses (staple*weight + vegetables*weight + oil*weight + pulses*weight = 7*2+7*1+4*0.5+4*3=35)."
              checked: true
      - layer: popatrisk
        output: csi
        title: CSI
        description: "Filter by VAM Coping Strategy Index (CSI).\n\nReference: [The Coping Strategies Index](http://documents.wfp.org/stellent/groups/public/documents/manual_guide_proced/wfp211058.pdf)"
        height: 34px
        type: checkbox
        checkbox:
          options:
            - id: "sparc-no"
              value: "no"
              label: "No"
              description: "No on the Coping Strategy Index"
              checked: true
            - id: "sparc-low"
              value: "low"
              label: "Low"
              description: "Low on the Coping Strategy Index"
              checked: true
            - id: "sparc-medium"
              value: "medium"
              label: "Medium"
              description: "Medium on the Coping Strategy Index"
              checked: true
            - id: "sparc-high"
              value: "high"
              label: "High"
              description: "High on the Coping Strategy Index"
              checked: true
      - layer: popatrisk
        output: ldi_range
        title: LDI
        description:  "Filter by the Land Degradation Index (LDI).  LDI combines negative land cover change and erosion propensity variables.\n\nHigh LDI levels indicate high land deterioration on a qualitative scale (undimensionless)."
        api: { type: grep, path: "properties.ldi", operand: between }
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-ldi-slider
            type: continuous
            width: 100px
            range: true  # See https://jqueryui.com/slider/#range
            label: "{{ values[0] | formatInteger:'delimited':' ' }} - {{ values[1] | formatInteger:'delimited':' ' }}"
            values: [1, 9]
            min: 1
            max: 9
            step: 1
      - layer: popatrisk
        output: landcover_delta_negative_range
        modifier: 1.0
        title: "Negative Landcover Change"
        description: "Negative Landcover Change"
        api: { type: grep, path: "properties.delta_negative", operand: between }
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-landcover-delta-negative-slider
            type: continuous
            width: 100px
            range: true  # See https://jqueryui.com/slider/#range
            label: "{{ values[0] | formatInteger:'delimited':' ' }} - {{ values[1] | formatInteger:'delimited':' ' }}"
            values: [0, 100]
            min: 0
            max: 100
            step: 1
      - layer: popatrisk
        output: erosion_propensity_range
        modifier: 1.0
        title: Erosion Propensity
        description:  "Filter by the erosion propensity, which indicates percentage of surface area under erosion process (> 5 Tons/ha per year).\nThe erosion propensity is calculated using the RUSLE equation (Rain incidence, Slope length, Lithology, Land cover)."
        api: { type: grep, path: "properties.erosion_propensity", operand: between }
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-erosion-propensity-slider
            type: continuous
            width: 100px
            range: true  # See https://jqueryui.com/slider/#range
            label: "{{ values[0] | formatInteger:'delimited':' ' }} - {{ values[1] | formatInteger:'delimited':' ' }}"
            values: [0, 100]
            min: 0
            max: 100
            step: 1
  {% endverbatim %}{% elif hazard == "drought" %}{% verbatim %}
    description: "The population at risk of drought for each month aggregated at the administrative level 2 district. Drought population at risk calculated considering negative rain anomalies by month from the ECWMF historical data, crossed with population presence (Landscan)."
    popup:
      title: "Population at Risk: {{ feature.attributes.admin2_name }}, {{ feature.attributes.admin1_name }}"
      maxWidth: 550
      panes:
        - id: "popup_overview"
          tab:
            label: "Overview"
          fields:
            - value: "{{ popatrisk('drought', feature, state, filters) | formatInteger : 'delimited' : ' ' }}"
              label: "Population at Risk for {{ state.month | formatMonth: 'long' }}"
          charts:
            - id: "sparc-popup-chart-popatrisk"
              title: "Population at Risk for {{ feature.attributes.admin2_name }} by Month"
              type: "bar"
              axis:
                x:
                  type: "months"
                y:
                  label:
                    text: 'Pop at Risk'
                    position: 'outer-middle'
              hazard: drought
              colors:
                1-5%: "#fcdc5d"
                5-10%: "#ffb45a"
                10-20%: "#ff8856"
                20-100%: "#ff5252"
              tooltip: { value: drought_value }
        - id: "popup_location"
          tab:
            label: "Location"
          fields:
            - attribute: iso_alpha3
              label: ISO Alpha-3 Country Code
            - value: "{{ feature.attributes.admin0_name }}"
              label: Admin 0
            - value: "{{ feature.attributes.admin1_name }}"
              label: Admin 1
            - value: "{{ feature.attributes.admin2_name }}"
              label: Admin 2
        #- id: "popup_vam_fcs"
        #  tab:
        #    label: "FCS"
        #  fields:
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.month') | formatMonth : 'long' }} {{ vam(feature.attributes.admin1_code,'fcs.year') }}"
        #      label: VAM FCS Date
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.source') }}"
        #      label: VAM FCS Source
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.poor') | formatFloat: 2 }}"
        #      label: VAM FCS Poor
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.borderline') | formatFloat: 2 }}"
        #      label: VAM FCS Borderline
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.acceptable') | formatFloat: 2 }}"
        #      label: VAM FCS Acceptable
        #- id: "popup_vam_csi"
        #  tab:
        #    label: "CSI"
        #  fields:
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.month') | formatMonth : 'long' }} {{ vam(feature.attributes.admin1_code,'csi.year') }}"
        #      label: VAM CSI Date
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.source') }}"
        #      label: VAM CSI Source
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.no') | formatFloat: 2 }}"
        #      label: VAM CSI No
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.low') | formatFloat: 2 }}"
        #      label: VAM CSI Low
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.medium') | formatFloat: 2 }}"
        #      label: VAM CSI Medium
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.high') | formatFloat: 2 }}"
        #      label: VAM CSI high
        - id: "popup_context"
          tab: { label: "Context" }
          fields:
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code,'ldi') }}"
              label: LDI
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_mean') | formatFloat: 2 | add : '%' }}"
              label: Mean Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_positive') | formatFloat: 2 | add : '%' }}"
              label: Positive Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_negative') | formatFloat: 2 | add : '%' }}"
              label: Negative Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_forest') | formatFloat: 2 | add : '%' }}"
              label: Forest Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_crop') | formatFloat: 2 | add : '%' }}"
              label: Crop Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'erosion_propensity') | formatFloat: 1 | add : '%' }}"
              label: Erosion Propensity
    filters:
      - layer: popatrisk
        output: popatrisk_range
        title: "Pop at Risk"
        description:  "The population at risk at the admin-2 level."
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-popatrisk-slider
            type: continuous
            width: 100px
            range: true  # See https://jqueryui.com/slider/#range
            label: "{{ values[0] | formatInteger:'delimited':' ' }} - {{ values[1] | formatInteger:'delimited':' ' }}"
            values: [0, {% endverbatim %}{{ maxValue }}{% verbatim %}]
            min: 0
            max: summary  # Overridden by max value from summary data
            step: 1
      - layer: popatrisk
        output: prob_class_max
        title: "Probability"
        description:  "The probability by admin2-month that a drought will occur."
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-probabilities-slider
            type: continuous
            width: 120px
            range: max
            label: "&gt; {{ value }}"
            value: 0.1
            min: 0
            max: 1.0
            step: 0.1
      - layer: popatrisk
        output: fcs
        title: FCS
        description: "Filter by VAM Food Consumption Score (FCS).\n\nReference: [http://documents.wfp.org/stellent/groups/public/documents/manual_guide_proced/wfp197216.pdf](http://documents.wfp.org/stellent/groups/public/documents/manual_guide_proced/wfp197216.pdf)"
        ui:
          height: 34px
          type: checkbox
          checkbox:
            options:
              - id: "sparc-poor"
                value: "poor"
                label: "Poor"
                description: "Food Consumption Score (FCS) from 0 to 21.  This means a household is expected NOT to eat at least staple and vegetables on a daily base and therefore considered to have poor food consumption.  The value 21 comes from an expected daily consumption of staple (frequency * weight, 7 * 2 = 14) and vegetables (7 * 1 = 7)."
                checked: true
              - id: "sparc-borderline"
                value: "borderline"
                label: "Borderline"
                description: "Food Consumption Score (FCS) from 21.5 to 35.  This means households are assessed having borderline food consumption.  The value 35 comes from an expected daily consumption of staple and vegetables complemented by a frequent (4 day/week) consumption of oil and pulses (staple*weight + vegetables*weight + oil*weight + pulses*weight = 7*2+7*1+4*0.5+4*3=35)."
                checked: true
              - id: "sparc-acceptable"
                value: "acceptable"
                label: "Acceptable"
                description: "Food Consumption Score (FCS) greater than 35.  This means households that score above 35 are estimated having acceptable food consumption.  The value 35 comes from an expected daily consumption of staple and vegetables complemented by a frequent (4 day/week) consumption of oil and pulses (staple*weight + vegetables*weight + oil*weight + pulses*weight = 7*2+7*1+4*0.5+4*3=35)."
                checked: true
      - layer: popatrisk
        output: csi
        title: CSI
        description: "Filter by VAM Coping Strategy Index (CSI).\n\nReference: [The Coping Strategies Index](http://documents.wfp.org/stellent/groups/public/documents/manual_guide_proced/wfp211058.pdf)"
        ui:
          height: 34px
          type: checkbox
          checkbox:
            options:
              - id: "sparc-no"
                value: "no"
                label: "No"
                description: "No on the Coping Strategy Index"
                checked: true
              - id: "sparc-low"
                value: "low"
                label: "Low"
                description: "Low on the Coping Strategy Index"
                checked: true
              - id: "sparc-medium"
                value: "medium"
                label: "Medium"
                description: "Medium on the Coping Strategy Index"
                checked: true
              - id: "sparc-high"
                value: "high"
                label: "High"
                description: "High on the Coping Strategy Index"
                checked: true
      - layer: popatrisk
        output: ldi_range
        title: LDI
        description:  "Filter by the Land Degradation Index (LDI).  LDI combines negative land cover change and erosion propensity variables.\n\nHigh LDI levels indicate high land deterioration on a qualitative scale (undimensionless)."
        api: { type: grep, path: "properties.ldi", operand: between }
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-ldi-slider
            type: continuous
            width: 100px
            range: true  # See https://jqueryui.com/slider/#range
            label: "{{ values[0] | formatInteger:'delimited':' ' }} - {{ values[1] | formatInteger:'delimited':' ' }}"
            values: [1, 9]
            min: 1
            max: 9
            step: 1
      - layer: popatrisk
        output: landcover_delta_negative_range
        modifier: 1.0
        title: "Negative Landcover Change"
        description: "Negative Landcover Change"
        api: { type: grep, path: "properties.delta_negative", operand: between }
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-landcover-delta-negative-slider
            type: continuous
            width: 100px
            range: true  # See https://jqueryui.com/slider/#range
            label: "{{ values[0] | formatInteger:'delimited':' ' }} - {{ values[1] | formatInteger:'delimited':' ' }}"
            values: [0, 100]
            min: 0
            max: 100
            step: 1
      - layer: popatrisk
        output: erosion_propensity_range
        modifier: 1.0
        title: Erosion Propensity
        description:  "Filter by the erosion propensity, which indicates percentage of surface area under erosion process (> 5 Tons/ha per year).\nThe erosion propensity is calculated using the RUSLE equation (Rain incidence, Slope length, Lithology, Land cover)."
        api: { type: grep, path: "properties.erosion_propensity", operand: between }
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-erosion-propensity-slider
            type: continuous
            width: 100px
            range: true  # See https://jqueryui.com/slider/#range
            label: "{{ values[0] | formatInteger:'delimited':' ' }} - {{ values[1] | formatInteger:'delimited':' ' }}"
            values: [0, 100]
            min: 0
            max: 100
            step: 1
  {% endverbatim %}{% elif hazard == "flood" %}{% verbatim %}
    description: "The population at risk of flood for each month aggregated at the administrative level 2 district. Flood population at risk calculated considering flood frequency expressed in ‘Return Period’ (RP) by GAR crossed with population presence (Landscan). (RP= probability that an event of certain intensity happens within a given period)"
    popup:
      title: "Population at Risk: {{ feature.attributes.admin2_name }}, {{ feature.attributes.admin1_name }}"
      maxWidth: 550
      panes:
        - id: "popup_overview"
          tab:
            label: "Overview"
          fields:
            - value: "{{ popatrisk('flood', feature, state, filters) | formatInteger : 'delimited' : ' ' }}"
              label: "Population at Risk for {{ state.month | formatMonth: 'long' }}"
          charts:
            - id: "sparc-popup-chart-popatrisk"
              title: "**Population at Risk for {{ feature.attributes.admin2_name }} by Month**\n(RP = Return Period)"
              type: "bar"
              axis:
                x:
                  type: "months"
                y:
                  label:
                    text: 'Pop at Risk'
                    position: 'outer-middle'
              hazard: flood
              subtype: "bullet"
              colors:
                rp25: "#0370dd"
                rp100: "#2A93fc"
                rp1000: "#86C2fd"
              returnPeriods: [25, 100, 1000]
              tooltip: { name: flood_name, value: flood_value }
        - id: "popup_location"
          tab:
            label: "Location"
          fields:
            - attribute: iso_alpha3
              label: ISO Alpha-3 Country Code
            - value: "{{ feature.attributes.admin0_name }}"
              label: Admin 0
            - value: "{{ feature.attributes.admin1_name }}"
              label: Admin 1
            - value: "{{ feature.attributes.admin2_name }}"
              label: Admin 2
        # - id: "popup_vam_fcs"
        #  tab:
        #    label: "FCS"
        #  fields:
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.month') | formatMonth : 'long' }} {{ vam(feature.attributes.admin1_code,'fcs.year') }}"
        #      label: VAM FCS Date
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.source') }}"
        #      label: VAM FCS Source
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.poor') | formatFloat: 2 }}"
        #      label: VAM FCS Poor
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.borderline') | formatFloat: 2 }}"
        #      label: VAM FCS Borderline
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.acceptable') | formatFloat: 2 }}"
        #      label: VAM FCS Acceptable
        #- id: "popup_vam_csi"
        #  tab:
        #    label: "CSI"
        #  fields:
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.month') | formatMonth : 'long' }} {{ vam(feature.attributes.admin1_code,'csi.year') }}"
        #      label: VAM CSI Date
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.source') }}"
        #      label: VAM CSI Source
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.no') | formatFloat: 2 }}"
        #      label: VAM CSI No
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.low') | formatFloat: 2 }}"
        #      label: VAM CSI Low
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.medium') | formatFloat: 2 }}"
        #      label: VAM CSI Medium
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.high') | formatFloat: 2 }}"
        #      label: VAM CSI high
        - id: "popup_context"
          tab: { label: "Context" }
          fields:
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code,'ldi') }}"
              label: LDI
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_mean') | formatFloat: 2 | add : '%' }}"
              label: Mean Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_positive') | formatFloat: 2 | add : '%' }}"
              label: Positive Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_negative') | formatFloat: 2 | add : '%' }}"
              label: Negative Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_forest') | formatFloat: 2 | add : '%' }}"
              label: Forest Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_crop') | formatFloat: 2 | add : '%' }}"
              label: Crop Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'erosion_propensity') | formatFloat: 1 | add : '%' }}"
              label: Erosion Propensity
    filters:
      - layer: popatrisk
        output: popatrisk_range
        title: "Pop at Risk"
        description:  "The population at risk at the admin-2 level."
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-popatrisk-slider
            type: continuous
            width: 100px
            range: true  # See https://jqueryui.com/slider/#range
            label: "{{ values[0] | formatInteger:'delimited':' ' }} - {{ values[1] | formatInteger:'delimited':' ' }}"
            values: [0, {% endverbatim %}{{ maxValue }}{% verbatim %}]
            min: 0
            max: {% endverbatim %}{{ maxValue }}{% verbatim %}  # Overridden by max value from summary data
            step: 1
      - layer: popatrisk
        output: rp
        title: "Return Period"
        description:  "Probability is based on the concept of \"return period\".  A return period is an estimate of the likelihood of an event, such as a flood, to occur. The theoretical return period is the inverse of the probability that the event will be exceeded in any one year (or more accurately the inverse of the expected number of occurrences in a year). In this case, a 100 year flood has a 0.01 or 1% chance of being exceeded in any one year."
        #api: { type: grep, path: "properties.rp", operand: "=" }
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-probabilities-slider
            type: ordinal
            width: 100px
            range: min
            value: 50
            label: "&lt;= {{ value }} RP"
            options: [25, 50, 100, 200, 500, 1000]
      - layer: popatrisk
        output: fcs
        title: FCS
        description: "Filter by VAM Food Consumption Score (FCS).\n\n\nReference: [Food Consumption Analysis](http://documents.wfp.org/stellent/groups/public/documents/manual_guide_proced/wfp197216.pdf)"
        ui:
          height: 34px
          type: checkbox
          checkbox:
            options:
              - id: "sparc-poor"
                value: "poor"
                label: "Poor"
                description: "Food Consumption Score (FCS) from 0 to 21.  This means a household is expected NOT to eat at least staple and vegetables on a daily base and therefore considered to have poor food consumption.  The value 21 comes from an expected daily consumption of staple (frequency * weight, 7 * 2 = 14) and vegetables (7 * 1 = 7)."
                checked: true
              - id: "sparc-borderline"
                value: "borderline"
                label: "Borderline"
                description: "Food Consumption Score (FCS) from 21.5 to 35.  This means households are assessed having borderline food consumption.  The value 35 comes from an expected daily consumption of staple and vegetables complemented by a frequent (4 day/week) consumption of oil and pulses (staple*weight + vegetables*weight + oil*weight + pulses*weight = 7*2+7*1+4*0.5+4*3=35)."
                checked: true
              - id: "sparc-acceptable"
                value: "acceptable"
                label: "Acceptable"
                description: "Food Consumption Score (FCS) greater than 35.  This means households that score above 35 are estimated having acceptable food consumption.  The value 35 comes from an expected daily consumption of staple and vegetables complemented by a frequent (4 day/week) consumption of oil and pulses (staple*weight + vegetables*weight + oil*weight + pulses*weight = 7*2+7*1+4*0.5+4*3=35)."
                checked: true
      - layer: popatrisk
        output: csi
        title: CSI
        description: "Filter by VAM Coping Strategy Index (CSI).\n\nReference: [The Coping Strategies Index](http://documents.wfp.org/stellent/groups/public/documents/manual_guide_proced/wfp211058.pdf)"
        ui:
          height: 34px
          type: checkbox
          checkbox:
            options:
              - id: "sparc-no"
                value: "no"
                label: "No"
                description: "No on the Coping Strategy Index"
                checked: true
              - id: "sparc-low"
                value: "low"
                label: "Low"
                description: "Low on the Coping Strategy Index"
                checked: true
              - id: "sparc-medium"
                value: "medium"
                label: "Medium"
                description: "Medium on the Coping Strategy Index"
                checked: true
              - id: "sparc-high"
                value: "high"
                label: "High"
                description: "High on the Coping Strategy Index"
                checked: true
      - layer: popatrisk
        output: ldi_range
        title: LDI
        description:  "Filter by the Land Degradation Index (LDI).  LDI combines negative land cover change and erosion propensity variables.\n\nHigh LDI levels indicate high land deterioration on a qualitative scale (undimensionless)."
        api: { type: grep, path: "properties.ldi", operand: between }
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-ldi-slider
            type: continuous
            width: 100px
            range: true  # See https://jqueryui.com/slider/#range
            label: "{{ values[0] | formatInteger:'delimited':' ' }} - {{ values[1] | formatInteger:'delimited':' ' }}"
            values: [1, 9]
            min: 1
            max: 9
            step: 1
      - layer: popatrisk
        output: landcover_delta_negative_range
        modifier: 1.0
        title: "Negative Landcover Change"
        description: "Negative Landcover Change"
        api: { type: grep, path: "properties.delta_negative", operand: between }
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-landcover-delta-negative-slider
            type: continuous
            width: 100px
            range: true  # See https://jqueryui.com/slider/#range
            label: "{{ values[0] | formatInteger:'delimited':' ' }} - {{ values[1] | formatInteger:'delimited':' ' }}"
            values: [0, 100]
            min: 0
            max: 100
            step: 1
      - layer: popatrisk
        output: erosion_propensity_range
        modifier: 1.0
        title: Erosion Propensity
        description:  "Filter by the erosion propensity, which indicates percentage of surface area under erosion process (> 5 Tons/ha per year).\n\nThe erosion propensity is calculated using the RUSLE equation (Rain incidence, Slope length, Lithology, Land cover)."
        api: { type: grep, path: "properties.erosion_propensity", operand: between }
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-erosion-propensity-slider
            type: continuous
            width: 100px
            range: true  # See https://jqueryui.com/slider/#range
            label: "{{ values[0] | formatInteger:'delimited':' ' }} - {{ values[1] | formatInteger:'delimited':' ' }}"
            values: [0, 100]
            min: 0
            max: 100
            step: 1
  {% endverbatim %}{% elif hazard == "landslide" %}{% verbatim %}
    description: "The population at risk of landslide for each month aggregated at the administrative level 2 district. Landslide Population at risk elaborated considering the landslide frequency from GAR crossed by the ‘population presence’ (Landscan) and disaggregated by month considering the ‘monthly rain incidence’ (WorldClim)"
    popup:
      title: "Population at Risk: {{ feature.attributes.admin2_name }}, {{ feature.attributes.admin1_name }}"
      maxWidth: 550
      panes:
        - id: "popup_overview"
          tab:
            label: "Overview"
          fields:
            - value: "{{ popatrisk('landslide', feature, state, filters) | formatInteger : 'delimited' : ' ' }}"
              label: "Population at Risk for {{ state.month | formatMonth: 'long' }}"
          charts:
            - id: "sparc-popup-chart-popatrisk"
              title: "Population at Risk for {{ feature.attributes.admin2_name }} by Month"
              type: "bar"
              axis:
                x:
                  type: "months"
                y:
                  label:
                    text: 'Pop at Risk'
                    position: 'outer-middle'
              hazard: landslide
              colors:
                low: "#fcdc5d"
                medium: "#ffb45a"
                high: "#ff8856"
                very_high: "#ff5252"
              tooltip: { value: landslide_value }
        - id: "popup_location"
          tab:
            label: "Location"
          fields:
            - attribute: iso_alpha3
              label: ISO Alpha-3 Country Code
            - value: "{{ feature.attributes.admin0_name }}"
              label: Admin 0
            - value: "{{ feature.attributes.admin1_name }}"
              label: Admin 1
            - value: "{{ feature.attributes.admin2_name }}"
              label: Admin 2
        #- id: "popup_vam_fcs"
        #  tab:
        #    label: "FCS"
        #  fields:
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.month') | formatMonth : 'long' }} {{ vam(feature.attributes.admin1_code,'fcs.year') }}"
        #      label: VAM FCS Date
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.source') }}"
        #      label: VAM FCS Source
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.poor') | formatFloat: 2 }}"
        #      label: VAM FCS Poor
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.borderline') | formatFloat: 2 }}"
        #      label: VAM FCS Borderline
        #    - value: "{{ vam(feature.attributes.admin1_code,'fcs.acceptable') | formatFloat: 2 }}"
        #      label: VAM FCS Acceptable
        #- id: "popup_vam_csi"
        #  tab:
        #    label: "CSI"
        #  fields:
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.month') | formatMonth : 'long' }} {{ vam(feature.attributes.admin1_code,'csi.year') }}"
        #      label: VAM CSI Date
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.source') }}"
        #      label: VAM CSI Source
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.no') | formatFloat: 2 }}"
        #      label: VAM CSI No
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.low') | formatFloat: 2 }}"
        #      label: VAM CSI Low
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.medium') | formatFloat: 2 }}"
        #      label: VAM CSI Medium
        #    - value: "{{ vam(feature.attributes.admin1_code,'csi.high') | formatFloat: 2 }}"
        #      label: VAM CSI high
        - id: "popup_context"
          tab: { label: "Context" }
          fields:
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code,'ldi') }}"
              label: LDI
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_mean') | formatFloat: 2 | add : '%' }}"
              label: Mean Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_positive') | formatFloat: 2 | add : '%' }}"
              label: Positive Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_negative') | formatFloat: 2 | add : '%' }}"
              label: Negative Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_forest') | formatFloat: 2 | add : '%' }}"
              label: Forest Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'delta_crop') | formatFloat: 2 | add : '%' }}"
              label: Crop Change (2001 - 2012)
            - value: "{{ context(feature.attributes.admin1_code, feature.attributes.admin2_code, 'erosion_propensity') | formatFloat: 1 | add : '%' }}"
              label: Erosion Propensity
    filters:
      - layer: popatrisk
        output: popatrisk_range
        title: "Pop at Risk"
        description:  "The population at risk at the admin-2 level."
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-popatrisk-slider
            type: continuous
            width: 100px
            range: true  # See https://jqueryui.com/slider/#range
            label: "{{ values[0] | formatInteger:'delimited':' ' }} - {{ values[1] | formatInteger:'delimited':' ' }}"
            values: [0, {% endverbatim %}{{ maxValue }}{% verbatim %}]
            min: 0
            max: {% endverbatim %}{{ maxValue }}{% verbatim %}  # Overridden by max value from summary data
            step: 1
      - layer: popatrisk
        output: prob_class_max
        title: "Hazard Class"
        description:  "Hazard Class ...."
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-probabilities-slider
            type: continuous
            width: 100px
            range: max
            label: "{{ value | add: -1 | choose : ['Low', 'Medium', 'High', 'Very High']  }} - Very High"
            value: 1
            min: 1
            max: 4
            step: 1
      - layer: popatrisk
        output: fcs
        title: FCS
        description: "Filter by VAM Food Consumption Score (FCS).\n\n\nReference: [Food Consumption Analysis](http://documents.wfp.org/stellent/groups/public/documents/manual_guide_proced/wfp197216.pdf)"
        height: 34px
        type: checkbox
        checkbox:
          options:
            - id: "sparc-poor"
              value: "poor"
              label: "Poor"
              description: "Food Consumption Score (FCS) from 0 to 21.  This means a household is expected NOT to eat at least staple and vegetables on a daily base and therefore considered to have poor food consumption.  The value 21 comes from an expected daily consumption of staple (frequency * weight, 7 * 2 = 14) and vegetables (7 * 1 = 7)."
              checked: true
            - id: "sparc-borderline"
              value: "borderline"
              label: "Borderline"
              description: "Food Consumption Score (FCS) from 21.5 to 35.  This means households are assessed having borderline food consumption.  The value 35 comes from an expected daily consumption of staple and vegetables complemented by a frequent (4 day/week) consumption of oil and pulses (staple*weight + vegetables*weight + oil*weight + pulses*weight = 7*2+7*1+4*0.5+4*3=35)."
              checked: true
            - id: "sparc-acceptable"
              value: "acceptable"
              label: "Acceptable"
              description: "Food Consumption Score (FCS) greater than 35.  This means households that score above 35 are estimated having acceptable food consumption.  The value 35 comes from an expected daily consumption of staple and vegetables complemented by a frequent (4 day/week) consumption of oil and pulses (staple*weight + vegetables*weight + oil*weight + pulses*weight = 7*2+7*1+4*0.5+4*3=35)."
              checked: true
      - layer: popatrisk
        output: csi
        title: CSI
        description: "Filter by VAM Coping Strategy Index (CSI).\n\nReference: [The Coping Strategies Index](http://documents.wfp.org/stellent/groups/public/documents/manual_guide_proced/wfp211058.pdf)"
        height: 34px
        type: checkbox
        checkbox:
          options:
            - id: "sparc-no"
              value: "no"
              label: "No"
              description: "No on the Coping Strategy Index"
              checked: true
            - id: "sparc-low"
              value: "low"
              label: "Low"
              description: "Low on the Coping Strategy Index"
              checked: true
            - id: "sparc-medium"
              value: "medium"
              label: "Medium"
              description: "Medium on the Coping Strategy Index"
              checked: true
            - id: "sparc-high"
              value: "high"
              label: "High"
              description: "High on the Coping Strategy Index"
              checked: true
      - layer: popatrisk
        output: ldi_range
        title: LDI
        description:  "Filter by the Land Degradation Index (LDI).  LDI combines negative land cover change and erosion propensity variables.\n\nHigh LDI levels indicate high land deterioration on a qualitative scale (undimensionless)."
        api: { type: grep, path: "properties.ldi", operand: between }
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-ldi-slider
            type: continuous
            width: 100px
            range: true  # See https://jqueryui.com/slider/#range
            label: "{{ values[0] | formatInteger:'delimited':' ' }} - {{ values[1] | formatInteger:'delimited':' ' }}"
            values: [1, 9]
            min: 1
            max: 9
            step: 1
      - layer: popatrisk
        output: landcover_delta_negative_range
        modifier: 1.0
        title: "Negative Landcover Change"
        description: "Negative Landcover Change"
        api: { type: grep, path: "properties.delta_negative", operand: between }
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-landcover-delta-negative-slider
            type: continuous
            width: 100px
            range: true  # See https://jqueryui.com/slider/#range
            label: "{{ values[0] | formatInteger:'delimited':' ' }} - {{ values[1] | formatInteger:'delimited':' ' }}"
            values: [0, 100]
            min: 0
            max: 100
            step: 1
      - layer: popatrisk
        output: erosion_propensity_range
        modifier: 1.0
        title: Erosion Propensity
        description:  "Filter by the erosion propensity, which indicates percentage of surface area under erosion process (> 5 Tons/ha per year).\n\nThe erosion propensity is calculated using the RUSLE equation (Rain incidence, Slope length, Lithology, Land cover)."
        api: { type: grep, path: "properties.erosion_propensity", operand: between }
        ui:
          height: 50px
          type: slider
          slider:
            id: sparc-erosion-propensity-slider
            type: continuous
            width: 100px
            range: true  # See https://jqueryui.com/slider/#range
            label: "{{ values[0] | formatInteger:'delimited':' ' }} - {{ values[1] | formatInteger:'delimited':' ' }}"
            values: [0, 100]
            min: 0
            max: 100
            step: 1
  {% endverbatim %}{% endif %}{% verbatim %}
  - id: vam_fcs
    type: geojson
    title: "Food Consumption Score"
    description: "VAM, Food Consumption Score"
    source: { name: "WFP/VAM", attribution: "WFP/VAM" }
    geojson: { local: "layers.vam.data.geojson" }
    download:
      links:
        - type: json
          title: GeoJSON
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/vam/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_VAM.json"
        - type: yaml
          title: YAML
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/vam/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_VAM.yml"
        - type: csv
          title: CSV
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/vam/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_VAM.csv"
        - type: zipped_shapefile
          title: "Zipped Shapefile"
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/vam/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_VAM.zip"
    carto:
      styles:
        - id: default
          title: "Default"
          description: "VAM, Food Consumption Score"
          legend: { type: graduated }
          symbolizers:
            - id: default
              title: Default Symbolizer
              description: "VAM, Food Consumption Score"
              type: polygon
              static:
                properties:
                  weight: 1
                  fillColor: "#000000"
                  fillOpacity: 0.4
                  strokeWidth: 1
                  strokeColor: "#000000"
    popup:
      title: "VAM FCS: {{ feature.attributes.admin1_name }}"
      maxWidth: 550
      panes:
        - id: "popup_vam_fcs"
          tab: { label: "FCS" }
          fields:
            - value: "{{ vam(feature.attributes.admin1_code,'fcs.month') | formatMonth : 'long' }} {{ vam(feature.attributes.admin1_code,'fcs.year') }}"
              label: VAM FCS Date
            - value: "{{ vam(feature.attributes.admin1_code,'fcs.source') }}"
              label: VAM FCS Source
            - value: "{{ vam(feature.attributes.admin1_code,'fcs.poor') | formatFloat: 2 }}"
              label: VAM FCS Poor
            - value: "{{ vam(feature.attributes.admin1_code,'fcs.borderline') | formatFloat: 2 }}"
              label: VAM FCS Borderline
            - value: "{{ vam(feature.attributes.admin1_code,'fcs.acceptable') | formatFloat: 2 }}"
              label: VAM FCS Acceptable
  - id: vam_csi
    type: geojson
    title: "Coping Strategies Index"
    description: "VAM, Coping Strategies Index"
    source: { name: "WFP/VAM", attribution: "WFP/VAM" }
    geojson: { local: "layers.vam.data.geojson" }
    download:
      links:
        - type: json
          title: GeoJSON
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/vam.json"
        - type: yaml
          title: YAML
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/vam.yml"
        - type: csv
          title: CSV
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/vam.csv"
        - type: zipped_shapefile
          title: "Zipped Shapefile"
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/vam.zip"
    carto:
      styles:
        - id: default
          title: "Default"
          description: "VAM, Coping Strategies Index"
          legend: { type: graduated }
          symbolizers:
            - id: default
              title: Default Symbolizer
              description: "VAM, Coping Strategies Index"
              type: polygon
              static:
                properties:
                  weight: 1
                  fillColor: "#000000"
                  fillOpacity: 0.4
                  strokeWidth: 1
                  strokeColor: "#000000"
    popup:
      title: "VAM CSI: {{ feature.attributes.admin1_name }}"
      maxWidth: 550
      panes:
        - id: "popup_vam_csi"
          tab: { label: "CSI" }
          fields:
            - value: "{{ vam(feature.attributes.admin1_code,'csi.month') | formatMonth : 'long' }} {{ vam(feature.attributes.admin1_code,'csi.year') }}"
              label: VAM CSI Date
            - value: "{{ vam(feature.attributes.admin1_code,'csi.source') }}"
              label: VAM CSI Source
            - value: "{{ vam(feature.attributes.admin1_code,'csi.no') | formatFloat: 2 }}"
              label: VAM CSI No
            - value: "{{ vam(feature.attributes.admin1_code,'csi.low') | formatFloat: 2 }}"
              label: VAM CSI Low
            - value: "{{ vam(feature.attributes.admin1_code,'csi.medium') | formatFloat: 2 }}"
              label: VAM CSI Medium
            - value: "{{ vam(feature.attributes.admin1_code,'csi.high') | formatFloat: 2 }}"
              label: VAM CSI high
  - id: context_mean_change
    type: geojson
    title: "Vegetation Balance"
    description: "Data Elaborated from NASA – MODIS 2001 & 2013. Vegetation balance performed between the total vegetation gains versus the total vegetation loss per administrative area. Considering the presence of vegetation and the relative ecosystem services, it has been fixed an ecological value per each Land cover class. Variations on ecological value have defined negative and positive changes. Land cover class and related ecological values considered: Forest (6); Wetland (6); Shrubland (5); Grassland (4); Cropland (3); Barren or Sparsely vegetated (2); Urban and built-up (1); Snow Ice (0); Water (0)."
    source: {% endverbatim %}{% include "sparc2/_includes/dashboard/layer/source.yml" %}{% verbatim %}
    geojson: { local: "layers.context.data.geojson", projection: "EPSG:4326" }
    legend: { ui: { source: false } }
    download:
      links:
        - type: api
          format: json
          title: GeoJSON
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.json"
          tooltip: { title: "API for systems integration.  Can be used with QGIS." }
        - type: api
          format: yaml
          title: YAML
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.yml"
          tooltip: { title: "Useful for reading." }
        - type: export
          format: csv
          title: CSV
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.csv"
          tooltip: { title: "Can be used with Microsoft Excel." }
        - type: export
          format: zipped_shapefile
          title: "Zipped Shapefile"
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.zip"
          tooltip: { title: "Can be use with GIS systems, e.g., GeoNode, ArcMap, and QGIS." }
    carto:
      styles:
        - id: delta_mean
          title: "Vegetation Balance"
          description: "Data Elaborated from NASA – MODIS 2001 & 2013. Vegetation balance performed between the total vegetation gains versus the total vegetation loss per administrative area."
          legend: { type: graduated }
          symbolizers:
            - id: default
              title: Default Symbolizer
              description: "Data Elaborated from NASA – MODIS 2001 & 2013. Vegetation balance performed between the total vegetation gains versus the total vegetation loss per administrative area."
              type: polygon
              metadata:
                range: [{ label: "| Overall Vegetation Loss" }, { label: "Overall Vegetation Gain |" }]
              static:
                properties:
                  weight: 1
                  fillColor: "#000000"
                  fillOpacity: 0.6
                  strokeWidth: 0.2
                  strokeColor: "#000000"
              dynamic:
                func: context
                options:
                  layer: context_mean_change
                  attribute: "delta_mean"
                  mask: "mask"
                  classes:
                    - { label: "High", color: 'rgb(181, 0, 22)' }
                    - { label: "Medium", color: 'rgb(251, 112, 80)' }
                    - { label: "Low", color: 'rgb(222, 197, 192)' }
                    - { label: "Low", color: 'rgb(227, 252, 216)' }
                    - { label: "Medium", color: 'rgb(122, 199, 123)' }
                    - { label: "High", color: 'rgb(0, 68, 27)' }
                  outside: { label: "No Change", placement: "middle", attribute: "mask", "color": "#333333" }
                  colors:
                    outside: "#333333"
                  breakpoints: "context_natural_adjusted"
                  filters: ["vam_filter_fcs", "vam_filter_csi"]
    popup:
      title: "{{ layer.title }}: {{ feature.attributes.admin2_name }}, {{ feature.attributes.admin1_name }}"
      maxWidth: 550
      panes:
        - id: "popup_overview"
          tab: { label: "overview" }
          fields:
            - { label: Mean Change, value: "{{ feature.attributes.delta_mean }}" }
            - attribute: iso_alpha3
              label: ISO Alpha-3 Country Code
            - value: "{{ feature.attributes.admin0_name }}"
              label: Admin 0
            - value: "{{ feature.attributes.admin1_name }}"
              label: Admin 1
            - value: "{{ feature.attributes.admin2_name }}"
              label: Admin 2
  - id: context_positive_change
    type: geojson
    title: "Surface % of Vegetation Gain"
    description: "Land Cover Data elaborated considering NASA – MODIS 2001 & 2013. Percentage of surfaces that experienced positive land cover change, ecological improve. High percentage values indicate large areas under positive land cover changes."
    source: {% endverbatim %}{% include "sparc2/_includes/dashboard/layer/source.yml" %}{% verbatim %}
    geojson: { local: "layers.context.data.geojson", projection: "EPSG:4326" }
    legend: { ui: { source: false } }
    download:
      links:
        - type: api
          format: json
          title: GeoJSON
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.json"
          tooltip: { title: "API for systems integration.  Can be used with QGIS." }
        - type: api
          format: yaml
          title: YAML
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.yml"
          tooltip: { title: "Useful for reading." }
        - type: export
          format: csv
          title: CSV
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.csv"
          tooltip: { title: "Can be used with Microsoft Excel." }
        - type: export
          format: zipped_shapefile
          title: "Zipped Shapefile"
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.zip"
          tooltip: { title: "Can be use with GIS systems, e.g., GeoNode, ArcMap, and QGIS." }
    carto:
      styles:
        - id: delta_positive
          title: "Surface % of Vegetation Gain"
          description: "Data elaborated considering NASA – MODIS 2001 & 2013. Percentage of surfaces that experienced increase in vegetated surface."
          legend: { type: graduated }
          symbolizers:
            - id: default
              title: Default Symbolizer
              description: "Data elaborated considering NASA – MODIS 2001 & 2013. Percentage of surfaces that experienced increase in vegetated surface."
              type: polygon
              metadata:
                range: [{ label: "| Low Vegetation Gain" }, { label: "High Vegetation Gain |" }]
              static:
                properties:
                  weight: 1
                  fillColor: "#000000"
                  fillOpacity: 0.6
                  strokeWidth: 0.2
                  strokeColor: "#000000"
              dynamic:
                func: context
                options:
                  layer: context_positive_change
                  attribute: "delta_positive"
                  mask: "mask"
                  classes:
                    - { label: "Low", color: 'rgb(227, 252, 216)' }
                    - { label: "Medium", color: 'rgb(122, 199, 123)' }
                    - { label: "High", color: 'rgb(0, 68, 27)' }
                  outside: { label: "No Change", placement: "start", attribute: "mask", "color": "#333333" }
                  colors: { outside: "#333333" }
                  breakpoints: "context_natural_positive"
                  filters: ["vam_filter_fcs", "vam_filter_csi"]
    popup:
      title: "{{ layer.title }}: {{ feature.attributes.admin2_name }}, {{ feature.attributes.admin1_name }}"
      maxWidth: 550
      panes:
        - id: "popup_overview"
          tab: { label: "overview" }
          fields:
            - { label: "{{ layer.title }}", value: "{{ feature.attributes.delta_positive | formatFloat : 2 | add : '%' }}" }
            - attribute: iso_alpha3
              label: ISO Alpha-3 Country Code
            - value: "{{ feature.attributes.admin0_name }}"
              label: Admin 0
            - value: "{{ feature.attributes.admin1_name }}"
              label: Admin 1
            - value: "{{ feature.attributes.admin2_name }}"
              label: Admin 2
  - id: context_negative_change
    type: geojson
    title: "Surface % of Vegetation Loss"
    description: "Land Cover Data elaborated considering NASA – MODIS 2001 & 2013. Percentage of surfaces that experienced negative land cover change, ecological deterioration. High percentage values indicate large areas under negative land cover changes."
    source: {% endverbatim %}{% include "sparc2/_includes/dashboard/layer/source.yml" %}{% verbatim %}
    geojson: { local: "layers.context.data.geojson", projection: "EPSG:4326" }
    legend: { ui: { source: false } }
    download:
      links:
        - type: api
          format: json
          title: GeoJSON
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.json"
          tooltip: { title: "API for systems integration.  Can be used with QGIS." }
        - type: api
          format: yaml
          title: YAML
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.yml"
          tooltip: { title: "Useful for reading." }
        - type: export
          format: csv
          title: CSV
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.csv"
          tooltip: { title: "Can be used with Microsoft Excel." }
        - type: export
          format: zipped_shapefile
          title: "Zipped Shapefile"
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.zip"
          tooltip: { title: "Can be use with GIS systems, e.g., GeoNode, ArcMap, and QGIS." }
    carto:
      styles:
        - id: delta_positive
          title: "Surface % of Vegetation Loss"
          description: "Data elaborated considering NASA – MODIS 2001 & 2013. Percentage of Surface that experienced decrease in vegetated surface."
          legend: { type: graduated }
          symbolizers:
            - id: default
              title: Default Symbolizer
              description: "Data elaborated considering NASA – MODIS 2001 & 2013. Percentage of Surface that experienced decrease in vegetated surface."
              type: polygon
              metadata:
                range: [{ label: "| Low Vegetation Loss" }, { label: "High Vegetation Loss |" }]
              static:
                properties:
                  weight: 1
                  fillColor: "#000000"
                  fillOpacity: 0.6
                  strokeWidth: 0.2
                  strokeColor: "#000000"
              dynamic:
                func: context
                options:
                  layer: context_negative_change
                  attribute: "delta_negative"
                  mask: "mask"
                  classes:
                    - { label: "Low", color: 'rgb(222, 197, 192)' }
                    - { label: "Medium", color: 'rgb(251, 112, 80)' }
                    - { label: "High", color: 'rgb(181, 0, 22)' }
                  outside: { label: "No Change", placement: "start", attribute: "mask", "color": "#333333" }
                  colors: { outside: "#333333" }
                  breakpoints: "context_natural_negative"
                  filters: ["vam_filter_fcs", "vam_filter_csi"]
    popup:
      title: "{{ layer.title }}: {{ feature.attributes.admin2_name }}, {{ feature.attributes.admin1_name }}"
      maxWidth: 550
      panes:
        - id: "popup_overview"
          tab: { label: "overview" }
          fields:
            - { label: "{{ layer.title }}", value: "{{ feature.attributes.delta_negative | formatFloat : 2 | add : '%' }}" }
            - attribute: iso_alpha3
              label: ISO Alpha-3 Country Code
            - value: "{{ feature.attributes.admin0_name }}"
              label: Admin 0
            - value: "{{ feature.attributes.admin1_name }}"
              label: Admin 1
            - value: "{{ feature.attributes.admin2_name }}"
              label: Admin 2
  - id: context_forest_change
    type: geojson
    title: "Surface % of Forest Change"
    description: "Land Cover Data elaborated considering NASA – MODIS 2001 & 2013. Positive values indicate increase in Forest surfaces. Negative values indicate decrease in Forest surfaces. ‘Forest’ class generalized merging the original MODIS class: ‘Evergreen Broadleaf forest’; ‘Evergreen Needleleaf forest’; ‘Deciduous Needleleaf forest’; ‘Deciduous Broadleaf forest’."
    source: {% endverbatim %}{% include "sparc2/_includes/dashboard/layer/source.yml" %}{% verbatim %}
    geojson: { local: "layers.context.data.geojson", projection: "EPSG:4326" }
    legend: { ui: { source: false } }
    download:
      links:
        - type: api
          format: json
          title: GeoJSON
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.json"
          tooltip: { title: "API for systems integration.  Can be used with QGIS." }
        - type: api
          format: yaml
          title: YAML
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.yml"
          tooltip: { title: "Useful for reading." }
        - type: export
          format: csv
          title: CSV
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.csv"
          tooltip: { title: "Can be used with Microsoft Excel." }
        - type: export
          format: zipped_shapefile
          title: "Zipped Shapefile"
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.zip"
          tooltip: { title: "Can be use with GIS systems, e.g., GeoNode, ArcMap, and QGIS." }
    carto:
      styles:
        - id: delta_forest
          title: "Surface % of Forest Change"
          description: "Land Cover Data elaborated considering NASA – MODIS 2001 & 2013.  Positive percentage indicates increase in Forest surfaces.  Negative percentage indicates decrease in Forest surfaces."
          legend: { type: graduated }
          symbolizers:
            - id: default
              title: "Surface % of Forest Change"
              description: "Land Cover Data elaborated considering NASA – MODIS 2001 & 2013.  Positive percentage indicates increase in Forest surfaces.  Negative percentage indicates decrease in Forest surfaces."
              type: polygon
              metadata:
                range: [{ label: "| Forest Decrease" }, { label: "Forest Increase |" }]
              static:
                properties:
                  weight: 1
                  fillColor: "#000000"
                  fillOpacity: 0.6
                  strokeWidth: 0.2
                  strokeColor: "#000000"
              dynamic:
                func: context
                options:
                  layer: context_forest_change
                  attribute: "delta_forest"
                  mask: "mask"
                  classes:
                    - { label: "High", color: 'rgb(181, 0, 38)' }
                    - { label: "Medium", color: 'rgb(253, 141, 60)' }
                    - { label: "Low", color: 'rgb(255, 255, 178)' }
                    - { label: "Low", color: 'rgb(227, 252, 216)' }
                    - { label: "Medium", color: 'rgb(122, 199, 123)' }
                    - { label: "High", color: 'rgb(0, 68, 27)' }
                  outside: { label: "No Change", placement: "middle", attribute: "mask", "color": "#333333" }
                  colors: { outside: "#333333" }
                  breakpoints: "context_natural_forest"
                  filters: ["vam_filter_fcs", "vam_filter_csi"]
    popup:
      title: "{{ layer.title }}: {{ feature.attributes.admin2_name }}, {{ feature.attributes.admin1_name }}"
      maxWidth: 550
      panes:
        - id: "popup_overview"
          tab: { label: "overview" }
          fields:
            - { label: "{{ layer.title }}", value: "{{ feature.attributes.delta_forest | formatFloat : 2 | add : '%' }}" }
            - attribute: iso_alpha3
              label: ISO Alpha-3 Country Code
            - value: "{{ feature.attributes.admin0_name }}"
              label: Admin 0
            - value: "{{ feature.attributes.admin1_name }}"
              label: Admin 1
            - value: "{{ feature.attributes.admin2_name }}"
              label: Admin 2
  - id: context_crop_change
    type: geojson
    title: "Surface % of Cropland Change"
    description: "Land Cover Data elaborated considering NASA – MODIS 2001 & 2012. Positive percentage indicates increase in Cropland surfaces. Negative percentage indicates decrease in Cropland surfaces. ‘Cropland’ class generalized from original MODIS class: ‘Cropland/Natural vegetation mosaic’; ‘Cropland’."
    source: {% endverbatim %}{% include "sparc2/_includes/dashboard/layer/source.yml" %}{% verbatim %}
    geojson: { local: "layers.context.data.geojson", projection: "EPSG:4326" }
    legend: { ui: { source: false } }
    download:
      links:
        - type: api
          format: json
          title: GeoJSON
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.json"
          tooltip: { title: "API for systems integration.  Can be used with QGIS." }
        - type: api
          format: yaml
          title: YAML
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.yml"
          tooltip: { title: "Useful for reading." }
        - type: export
          format: csv
          title: CSV
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.csv"
          tooltip: { title: "Can be used with Microsoft Excel." }
        - type: export
          format: zipped_shapefile
          title: "Zipped Shapefile"
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.zip"
          tooltip: { title: "Can be use with GIS systems, e.g., GeoNode, ArcMap, and QGIS." }
    carto:
      styles:
        - id: delta_forest
          title: "Surface % of Cropland Change"
          description: "Land Cover Data elaborated considering NASA – MODIS 2001 & 2013.  Positive percentage indicates increase in Cropland surfaces.  Negative percentage indicates decrease in Cropland surfaces."
          legend: { type: graduated }
          symbolizers:
            - id: default
              title: "Surface % of Cropland Change"
              description: "Land Cover Data elaborated considering NASA – MODIS 2001 & 2013.  Positive percentage indicates increase in Cropland surfaces.  Negative percentage indicates decrease in Cropland surfaces."
              type: polygon
              metadata:
                range: [{ label: "| Cropland Decrease" }, { label: "Cropland Increase |" }]
              static:
                properties:
                  weight: 1
                  fillColor: "#000000"
                  fillOpacity: 0.6
                  strokeWidth: 0.2
                  strokeColor: "#000000"
              dynamic:
                func: context
                options:
                  layer: context_crop_change
                  attribute: "delta_crop"
                  mask: "mask"
                  classes:
                    - { label: "High", color: 'rgb(181, 0, 38)' }
                    - { label: "Medium", color: 'rgb(253, 141, 60)' }
                    - { label: "Low", color: 'rgb(255, 255, 178)' }
                    - { label: "Low", color: 'rgb(227, 252, 216)' }
                    - { label: "Medium", color: 'rgb(122, 199, 123)' }
                    - { label: "High", color: 'rgb(0, 68, 27)' }
                  outside: { label: "No Change", placement: "middle", attribute: "mask", "color": "#333333" }
                  colors: { outside: "#333333" }
                  breakpoints: "context_natural_crop"
                  filters: ["vam_filter_fcs", "vam_filter_csi"]
    popup:
      title: "{{ layer.title }}: {{ feature.attributes.admin2_name }}, {{ feature.attributes.admin1_name }}"
      maxWidth: 550
      panes:
        - id: "popup_overview"
          tab: { label: "overview" }
          fields:
            - { label: "{{ layer.title }}", value: "{{ feature.attributes.delta_crop | formatFloat : 2 | add : '%' }}" }
            - attribute: iso_alpha3
              label: ISO Alpha-3 Country Code
            - value: "{{ feature.attributes.admin0_name }}"
              label: Admin 0
            - value: "{{ feature.attributes.admin1_name }}"
              label: Admin 1
            - value: "{{ feature.attributes.admin2_name }}"
              label: Admin 2
  - id: context_erosion
    type: geojson
    title: "Erosion Propensity"
    description: "Erosion layer elaborated considering the RUSLE equation (combining by analytical formulas: Rain incidence, Slope length, Lithology, Land cover). Erosion percentage indicates areas under erosion process (areas characterized by erosion > 5 Tons/ha per year). High values indicate large surfaces under erosion."
    source: {% endverbatim %}{% include "sparc2/_includes/dashboard/layer/source.yml" %}{% verbatim %}
    geojson: { local: "layers.context.data.geojson", projection: "EPSG:4326" }
    legend: { ui: { source: false } }
    download:
      links:
        - type: api
          format: json
          title: GeoJSON
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.json"
          tooltip: { title: "API for systems integration.  Can be used with QGIS." }
        - type: api
          format: yaml
          title: YAML
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.yml"
          tooltip: { title: "Useful for reading." }
        - type: export
          format: csv
          title: CSV
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.csv"
          tooltip: { title: "Can be used with Microsoft Excel." }
        - type: export
          format: zipped_shapefile
          title: "Zipped Shapefile"
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.zip"
          tooltip: { title: "Can be use with GIS systems, e.g., GeoNode, ArcMap, and QGIS." }
    carto:
      styles:
        - id: erosion_propensity
          title: "Erosion Propensity"
          description: "Erosion layer elaborated considering the RUSLE equation (Rain incidence, Slope length, Lithology, Land cover).  Erosion percentage indicates areas under erosion process (> 5 Tons/ha per year)."
          legend: { type: graduated }
          symbolizers:
            - id: default
              title: Default Symbolizer
              description: "Erosion layer elaborated considering the RUSLE equation (Rain incidence, Slope length, Lithology, Land cover).  Erosion percentage indicates areas under erosion process (> 5 Tons/ha per year)."
              type: polygon
              metadata:
                range: [{ label: "| Low Erosion Propensity" }, { label: "High Erosion Propensity |" }]
              static:
                properties:
                  weight: 1
                  fillColor: "#000000"
                  fillOpacity: 0.6
                  strokeWidth: 0.2
                  strokeColor: "#000000"
              dynamic:
                func: context
                options:
                  layer: context_erosion
                  attribute: "erosion_propensity"
                  classes:
                    - { label: "Zero", color: '#aaaaaa' }
                    - { label: "Low", color: 'rgb(255, 255, 212)' }
                    - { label: "Medium", color: 'rgb(254, 153, 41)' }
                    - { label: "High", color: 'rgb(153, 52, 4)' }
                  breakpoints: "context_natural_erosion_propensity"
                  filters: ["vam_filter_fcs", "vam_filter_csi"]
    popup:
      title: "{{ layer.title }}: {{ feature.attributes.admin2_name }}, {{ feature.attributes.admin1_name }}"
      maxWidth: 550
      panes:
        - id: "popup_overview"
          tab: { label: "overview" }
          fields:
            - value: "{{ feature.attributes.erosion_propensity | formatFloat: 1 | add : '%' }}"
              label: Erosion Propensity
            - attribute: iso_alpha3
              label: ISO Alpha-3 Country Code
            - value: "{{ feature.attributes.admin0_name }}"
              label: Admin 0
            - value: "{{ feature.attributes.admin1_name }}"
              label: Admin 1
            - value: "{{ feature.attributes.admin2_name }}"
              label: Admin 2
  - id: context_ldi
    type: geojson
    title: "Land Degradation Index"
    description: "Land Degradation Index combines the negative land cover change and erosion propensity information. High LDI levels indicate high land deterioration on a qualitative scale (un-dimensionless) 1-9. Values next to 1 represent very low negative impact; value next to 9 represent strong negative impact. The LDI could be considered like a land degradation synthesis index."
    source: {% endverbatim %}{% include "sparc2/_includes/dashboard/layer/source.yml" %}{% verbatim %}
    geojson: { local: "layers.context.data.geojson", projection: "EPSG:4326" }
    legend: { ui: { source: false } }
    download:
      links:
        - type: api
          format: json
          title: GeoJSON
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.json"
          tooltip: { title: "API for systems integration.  Can be used with QGIS." }
        - type: api
          format: yaml
          title: YAML
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.yml"
          tooltip: { title: "Useful for reading." }
        - type: export
          format: csv
          title: CSV
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.csv"
          tooltip: { title: "Can be used with Microsoft Excel." }
        - type: export
          format: zipped_shapefile
          title: "Zipped Shapefile"
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/dataset/context/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_ContextLayers.zip"
          tooltip: { title: "Can be use with GIS systems, e.g., GeoNode, ArcMap, and QGIS." }
    carto:
      styles:
        - id: ldi
          title: "LDI"
          description: Land Degradation Index combines the negative land cover change and erosion propensity information.  High LDI levels indicate high land deterioration on a qualitative scale (undimensionless).
          legend: { type: graduated }
          symbolizers:
            - id: default
              title: Default Symbolizer
              description: Land Degradation Index combines the negative land cover change and erosion propensity information.  High LDI levels indicate high land deterioration on a qualitative scale (undimensionless).
              type: polygon
              metadata:
                range: [{ label: "| Low LDI" }, { label: "High LDI |" }]
              static:
                properties:
                  weight: 1
                  fillColor: "#000000"
                  fillOpacity: 0.6
                  strokeWidth: 0.2
                  strokeColor: "#000000"
              dynamic:
                func: ldi
                options:
                  layer: context_ldi
                  attribute: "ldi"
                  mask: "mask"
                  classes:
                    - { label: "1", color: 'rgb(143, 199, 142)' }
                    - { label: "2", color: 'rgb(196, 214, 178)' }
                    - { label: "3", color: 'rgb(254, 217, 157)' }
                    - { label: "4", color: 'rgb(253, 191, 111)' }
                    - { label: "5", color: 'rgb(240, 215, 47)' }
                    - { label: "6", color: 'rgb(253, 194, 58)' }
                    - { label: "7", color: 'rgb(240, 126, 47)' }
                    - { label: "8", color: 'rgb(240, 87, 36)' }
                    - { label: "9", color: 'rgb(227, 26, 28)' }
                  colors: { outside: "#333333" }
                  filters: ["vam_filter_fcs", "vam_filter_csi"]
    popup:
      title: "{{ layer.title }}: {{ feature.attributes.admin2_name }}, {{ feature.attributes.admin1_name }}"
      maxWidth: 550
      panes:
        - id: "popup_overview"
          tab: { label: "overview" }
          fields:
            - { label: "LDI", value: "{{ feature.attributes.ldi }}" }
            - attribute: iso_alpha3
              label: ISO Alpha-3 Country Code
            - value: "{{ feature.attributes.admin0_name }}"
              label: Admin 0
            - value: "{{ feature.attributes.admin1_name }}"
              label: Admin 1
            - value: "{{ feature.attributes.admin2_name }}"
              label: Admin 2
  - id: landscan
    type: WMS
    title: "Landscan (2013)"
    description: "Landscan (2013)"
    source: { name: "ORNL", attribution: "ORNL" }
    legend: { ui: { source: false } }
    wms:
      version: "1.1.1"
      layers: ["geonode:sparc_landscan_2013"]
      styles: ["landscan_2013"]
      format: 'image/png'
      transparent: true
      url: "https://staging.geonode.wfp.org/cors/geoserver/wms"
  - id: forecast_1day
    type: WMS
    title: "FC Cumulated Rainfall: 1 day"
    description: "Forecast precipitation accumulation for next 24 hours."
    source:
      name: "ITHACA"
      attribution: "ITHACA"
    legend: { ui: { source: false } }
    wms:
      version: "1.1.0"
      layers: ["erds:apcp_cumulated_24h"]
      styles: []
      format: 'image/png'
      transparent: true
      buffer: 256
      url: "http://erds.ithacaweb.org/geoserver/erds/wms"
    cartography:
      - id: default
        legend:
          symbol:
            type: "graphic"
            width: 16
            height: 16
            preview: false
  - id: forecast_3day
    type: WMS
    title: "FC Cumulated Rainfall: 3 days"
    description: "Forecast precipitation accumulation for next 3 days."
    source:
      name: "ITHACA"
      attribution: "ITHACA"
    legend: { ui: { source: false } }
    wms:
      version: "1.1.0"
      layers: ["erds:apcp_cumulated_72h"]
      styles: []
      format: 'image/png'
      transparent: true
      buffer: 256
      url: "http://erds.ithacaweb.org/geoserver/erds/wms"
    cartography:
      - id: default
        legend:
          symbol:
            type: "graphic"
            width: 16
            height: 16
            preview: false
  - id: forecast_6day
    type: WMS
    title: "FC Cumulated Rainfall: 6 days"
    description: "Forecast precipitation accumulation for next 6 days."
    source:
      name: "ITHACA"
      attribution: "ITHACA"
    legend: { ui: { source: false } }
    wms:
      version: "1.1.0"
      layers: ["erds:apcp_cumulated_144h"]
      styles: []
      format: 'image/png'
      transparent: true
      buffer: 256
      url: "http://erds.ithacaweb.org/geoserver/erds/wms"
    cartography:
      - id: default
        legend:
          symbol:
            type: "graphic"
            width: 16
            height: 16
            preview: false
  - id: nrt_1day
    type: WMS
    title: "NRT Cumulated Rainfall: 1 day"
    description: "Rainfall accumulation considering the past 24h (mm). GPM - IMERG, version 4.5. NASA's Precipitation Processing Center."
    source:
      name: "ITHACA"
      attribution: "ITHACA"
    wms:
      version: "1.1.0"
      layers: ["erds:precip_024h"]
      styles: []
      format: 'image/png'
      transparent: true
      url: "http://erds.ithacaweb.org/geoserver/erds/wms"
    cartography:
      - id: default
        legend:
          symbol:
            type: "graphic"
            width: 16
            height: 16
            preview: false
  - id: nrt_2day
    type: WMS
    title: "NRT Cumulated Rainfall: 2 days"
    description: "Rainfall accumulation considering the past 2 days (mm). GPM - IMERG, version 4.5. NASA's Precipitation Processing Center."
    source:
      name: "ITHACA"
      attribution: "ITHACA"
    wms:
      version: "1.1.0"
      layers: ["erds:precip_048h"]
      styles: []
      format: 'image/png'
      transparent: true
      url: "http://erds.ithacaweb.org/geoserver/erds/wms"
    cartography:
      - id: default
        legend:
          symbol:
            type: "graphic"
            width: 16
            height: 16
            preview: false
  - id: nrt_3day
    type: WMS
    title: "NRT Cumulated Rainfall: 3 days"
    description: "Rainfall accumulation considering the past 3 days (mm). GPM - IMERG, version 4.5. NASA's Precipitation Processing Center."
    source:
      name: "ITHACA"
      attribution: "ITHACA"
    wms:
      version: "1.1.0"
      layers: ["erds:precip_072h"]
      styles: []
      format: 'image/png'
      transparent: true
      url: "http://erds.ithacaweb.org/geoserver/erds/wms"
    cartography:
      - id: default
        legend:
          symbol:
            type: "graphic"
            width: 16
            height: 16
            preview: false
  - id: wld_poi_facilities_wfp
    type: WMS
    title: "Global WFP Facilities"
    description: "WFP Facilities worldwide, Country Office, Sub-Office, Field Office, Area Office, Humanitarian Response Depot."
    source: {% endverbatim %}{% include "sparc2/_includes/dashboard/layer/source.yml" %}{% verbatim %}
    legend: { ui: { source: false } }
    wms:
      version: "1.1.1"
      layers: ["geonode:wld_poi_facilities_wfp"]
      styles: []
      format: 'image/png'
      transparent: true
      buffer: 256
      url: "http://geonode.wfp.org/cors/geoserver/wms"
      cql_filter: "iso3 = {% endverbatim %}'{{ iso_alpha3|upper }}'{% verbatim %}"
    wfs: { version: "1.0.0", url: "http://geonode.wfp.org/cors/geoserver/wfs", geometry: shape }
    kml:
      url: "http://geonode.wfp.org/cors/geoserver/wms/kml"
    gwc:
      tiles: "http://geonode.wfp.org/geoserver/gwc/service/tms/1.0.0/{typename}@EPSG:900913@png/{z}/{x}/{y}.png"
    download:
      links:
        - type: json
          title: GeoJSON
          baseurl: "{{ layer.wfs.url }}?srsName=EPSG%3A4326&typename=geonode%3Awld_poi_facilities_wfp&outputFormat=json&version=1.0.0&service=WFS&request=GetFeature"
        - type: csv
          title: CSV
          baseurl: "{{ layer.wfs.url }}?typename=geonode%3Awld_poi_facilities_wfp&outputFormat=csv&version=1.0.0&request=GetFeature&service=WFS"
        - type: shapefile
          title: Shapefile (Zipped)
          baseurl: "{{ layer.wfs.url }}?format_options=charset%3AUTF-8&typename=geonode%3Awld_poi_facilities_wfp&outputFormat=SHAPE-ZIP&version=1.0.0&service=WFS&request=GetFeature"
    click: popup
    popup:
      title: "Global WFP Facilities: {{ feature.attributes.name }}"
      maxWidth: 550
      panes:
        - id: "popup_overview"
          tab:
            label: "Overview"
          fields:
            - output: name
              inputs:
                - 'whlocation'
                - 'place'
              label: Name
            - attribute: facility
              label: Facility
              when: "defined"
            - attribute: status
              label: Status
            - attribute: country
              label: Country
        - id: "popup_location"
          tab:
            label: "Location"
          fields:
            - attribute: locprecision
              label: Location Precision
            - attribute: latitude
              label: Latitude
            - attribute: longitude
              label: Longitude
            - attribute: compasscode
              label: Compass Code
              when: "defined"
            - attribute: geonameid
              label: GeoName ID
              when: "defined"
        - id: "popup_currency"
          tab:
            label: "Currency"
          fields:
            - attribute: lastcheckdate
              label: Last Check Date
              type: date
              format: 'medium'
              fallback: 'Not specified'
            - attribute: createdate
              label: Date Created
              type: date
              format: 'medium'
            - attribute: updatedate
              label: Date Updated
              type: date
              format: 'medium'
        - id: "popup_links"
          tab:
            label: "Links"
          fields:
            - attribute: geonameid
              value: "{{ feature.attributes.geonameid }}"
              type: link
              label: "GeoNames"
              url: "http://www.geonames.org/{{ feature.attributes.geonameid }}/"
              when: "defined"
            - value: "{{ feature.geometry.lat | number : 4 }}, {{ feature.geometry.lng | number : 4 }}"
              type: link
              label: "OpenStreetMap"
              url: "https://www.openstreetmap.org/#map=15/{{ feature.geometry.lat }}/{{ feature.geometry.lng }}"
  - id: wld_trs_supplyroutes_wfp
    type: WMS
    title: "Global Supply Routes"
    description: "Global supply routes for Transportation of Food and Non Food Items - Roads, Railways, Waterway, Airways.\n\nThis layer is built by linking origin/destination locations using the most direct route on main roads. In reality, the supply routes can divert from the ones displayed here depending on many local factors. The routes shown in this dataset are only indicative and have to be used as such."
    source: {% endverbatim %}{% include "sparc2/_includes/dashboard/layer/source.yml" %}{% verbatim %}
    legend: { ui: { source: false } }
    wms:
      version: "1.1.1"
      layers: ["geonode:wld_trs_supplyroutes_wfp"]
      styles: []
      format: 'image/png'
      transparent: true
      buffer: 256
      url: "http://geonode.wfp.org/cors/geoserver/wms"
      cql_filter: {% endverbatim %}"iso3 = '{{ iso_alpha3|upper }}' OR iso3_op = '{{ iso_alpha3|upper }}'"{% verbatim %}
    wfs: { version: "1.0.0", url: "http://geonode.wfp.org/cors/geoserver/wfs", geometry: shape }
    kml:
      url: "http://geonode.wfp.org/cors/geoserver/wms/kml"
    gwc:
      tiles: "http://geonode.wfp.org/geoserver/gwc/service/tms/1.0.0/{typename}@EPSG:900913@png/{z}/{x}/{y}.png"
    cartography:
      - title: "Default"
        legend:
          symbol:
            type: "graphic"
            width: 16
            height: 16
            preview: false
    click: popup
    popup:
      title: "Global Supply Routes: {{ feature.attributes.name }}"
      maxWidth: 550
      panes:
        - id: "popup_overview"
          tab:
            label: "Overview"
          fields:
            - output: name
              inputs:
                - 'nameportion'
              label: Name
            - attribute: Status
              label: Status
            - attribute: practicability
              label: Practicability
        - id: "popup_location"
          tab:
            label: "Location"
          fields:
            - attribute: Traveltime
              label: Travel Time
              fallback: 'Not specified'
            - attribute: distancekm
              label: Distance (KM)
              fallback: 'Not specified'
        - id: "popup_currency"
          tab:
            label: "Currency"
          fields:
            - attribute: lastcheckdate
              label: Last Check Date
              type: date
              format: 'medium'
              fallback: 'Not specified'
            - attribute: createdate
              label: Date Created
              type: date
              format: 'medium'
              fallback: 'Not specified'
            - attribute: updatedate
              label: Date Updated
              type: date
              format: 'medium'
              fallback: 'Not specified'
        - id: "popup_links"
          tab:
            label: "Links"
          fields:
            - value: "CAR Operation"
              type: link
              label: "Logistics Cluster:"
              url: "http://www.logcluster.org/ops/caf13a"
            - value: "{{ layer.title }} via {{ layer.source.site }}"
              type: link
              label: "Source"
              url: "http://geonode.wfp.org/layers/{{ layer.wms.layers | first }}"
  {% endverbatim %}{% if hazard == "cyclone" %}{% verbatim %}
  - id: cyclone_probability
    type: WMS
    title: "Cyclone Probability"
    description: "Cyclone Probability"
    source: {% endverbatim %}{% include "sparc2/_includes/dashboard/layer/source.yml" %}{% verbatim %}
    legend: { ui: { source: false } }
    wms:
      version: "1.1.1"
      layers: {% endverbatim %}["geonode:cat1_5_sep_cls2","geonode:cat1_5_sep_cls2","geonode:cat1_5_sep_cls2","geonode:cat1_5_sep_cls2","geonode:cat1_5_sep_cls2","geonode:cat1_5_sep_cls2","geonode:cat1_5_sep_cls2"]{% verbatim %}
      styles: ["cyclone1","cyclone2","cyclone3","cyclone4","cyclone5","cyclone6","cyclone7"]
      format: 'image/png'
      transparent: true
      url: "http://10.11.40.84/geoserver/geonode/wms"
    cartography:
      - id: default
        type: graphic
        description: "Cyclone Probability"
        legend:
          symbol:
            type: "graphic"
            width: 16
            height: 8
            preview: false
  - id: cyclone_events
    enabled: true
    type: geojson
    title: "Cyclone Events (Heatmap)"
    description: "This layer contains a heatmap of cyclone events."
    source: {% endverbatim %}{% include "sparc2/_includes/dashboard/layer/source.yml" %}{% verbatim %}
    geojson: { url: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/cyclone/dataset/events.json" }
    legend: { ui: { source: false } }
    heatmap:
      radius: 8
      blur: 10
      weight: count
    download:
      links:
        - type: json
          title: GeoJSON
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/cyclone/dataset/events.json"
        - type: yaml
          title: YAML
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/cyclone/dataset/events.yml"
        - type: csv
          title: CSV
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/cyclone/dataset/events.csv"
        - type: zipped_shapefile
          title: "Zipped Shapefile"
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/cyclone/dataset/events.zip"
  {% endverbatim %}{% elif hazard == "drought" %}{% verbatim %}
  - id: wlddsi_fot02d3
    type: WMS
    title: "Drought Frequency (January)"
    description: "Drought Frequency (January)"
    source: {% endverbatim %}{% include "sparc2/_includes/dashboard/layer/source.yml" %}{% verbatim %}
    legend: { ui: { source: false } }
    wms:
      version: "1.1.1"
      layers: ["wlddsi_fot02d3"]
      styles:
      format: 'image/png'
      transparent: true
      url: "https://staging.geonode.wfp.org/cors/geoserver/wms"
    cartography:
      - id: default
        type: graphic
        description: "Drought Frequency (January)"
        legend:
          symbol:
            type: "graphic"
            width: 16
            height: 8
            preview: false
  {% endverbatim %}{% elif hazard == "flood" %}{% verbatim %}
  - id: flood_probability
    type: WMS
    title: "Flood Probability"
    description: "Flood Probability"
    source: {% endverbatim %}{% include "sparc2/_includes/dashboard/layer/source.yml" %}{% verbatim %}
    legend: { ui: { source: false } }
    wms:
      version: "1.1.1"
      #layers: ["sparc_flood_probability","sparc_flood_probability","sparc_flood_probability","sparc_flood_probability","sparc_flood_probability","sparc_flood_probability"]
      layers: ["wlddsi_fot02d3"] #drought layer
      #styles: ["RP25","RP50","RP100","RP200","RP500","RP1000"]
      styles:
      format: 'image/png'
      transparent: true
      url: "https://staging.geonode.wfp.org/cors/geoserver/wms"
    cartography:
      - id: default
        type: graphic
        description: "Flood Probability"
        legend:
          symbol:
            type: "graphic"
            width: 16
            height: 8
            preview: false
  - id: flood_events
    enabled: true
    type: geojson
    title: "Heatmap of Flood Events"
    description: "This layer contains a heatmap of flood events."
    source: {% endverbatim %}{% include "sparc2/_includes/dashboard/layer/source.yml" %}{% verbatim %}
    geojson: { url: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/flood/dataset/events/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_FloodEvents.json" }
    heatmap: { radius: 15, blur: 15, weight: count }
    legend: { ui: { source: false } }
    download:
      links:
        - type: json
          title: GeoJSON
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/flood/dataset/events/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_FloodEvents.json"
        - type: yaml
          title: YAML
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/flood/dataset/events/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_FloodEvents.yml"
        - type: csv
          title: CSV
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/flood/dataset/events/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_FloodEvents.csv"
        - type: zipped_shapefile
          title: "Zipped Shapefile"
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/flood/dataset/events/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_FloodEvents.zip"
    carto:
      styles:
        - id: flood_events
          title: "Heatmap of Flood Events"
          description: "Heatmap of flood events for visual interpretability."
          legend: { type: heatmap }
          symbolizers:
            - id: default
              title: "Heatmap of Flood Events"
              description: "Heatmap of flood events for visual interpretability."
              type: polygon
              metadata:
                range: [{ label: "| Low Intensity" }, { label: "High Intensity |" }]
  - id: landslide_events
    enabled: true
    type: geojson
    title: "Heatmap of Landslide Events"
    description: "This layer contains a heatmap of landslide events."
    source: {% endverbatim %}{% include "sparc2/_includes/dashboard/layer/source.yml" %}{% verbatim %}
    geojson: { url: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/landslide/dataset/events/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_LandslideEvents.json" }
    heatmap: { radius: 6, blur: 8, weight: count }
    legend: { ui: { source: false } }
    download:
      links:
        - type: json
          title: GeoJSON
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/landslide/dataset/events/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_LandslideEvents.json"
        - type: yaml
          title: YAML
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/landslide/dataset/events/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_LandslideEvents.yml"
        - type: csv
          title: CSV
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/landslide/dataset/events/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_LandslideEvents.csv"
        - type: zipped_shapefile
          title: "Zipped Shapefile"
          baseurl: "/api/data/country/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}/hazard/landslide/dataset/events/{% endverbatim %}{{ iso_alpha3|upper }}{% verbatim %}_NHR_LandslideEvents.zip"
    carto:
      styles:
        - id: landslide_events
          title: "Heatmap of Landslide Events"
          description: "Heatmap of landslide events for visual interpretability."
          legend: { type: heatmap }
          symbolizers:
            - id: default
              title: "Heatmap of Landslide Events"
              description: "Heatmap of landslide events for visual interpretability."
              type: polygon
              metadata:
                range: [{ label: "| Low Intensity" }, { label: "High Intensity |" }]
    {% endverbatim %}{% endif %}
{% endblock %}

{% block renderlayers %}
renderlayers:
  - forecast_1day
  - forecast_3day
  - forecast_6day
  #- wld_poi_facilities_wfp
  #- wld_trs_supplyroutes_wfp
  {% if hazard == "cyclone" %}{% verbatim %}
  - popatrisk
  - context_mean_change
  - context_positive_change
  - context_negative_change
  - context_forest_change
  - context_crop_change
  - context_erosion
  - context_ldi
  - cyclone_probability
  - cyclone_events
  {% endverbatim %}{% elif hazard == "drought" %}{% verbatim %}
  - popatrisk
  - context_mean_change
  - context_positive_change
  - context_negative_change
  - context_forest_change
  - context_crop_change
  - context_erosion
  - context_ldi
  - wlddsi_fot02d3
  {% endverbatim %}{% elif hazard == "flood" %}{% verbatim %}
  - popatrisk
  - context_mean_change
  - context_positive_change
  - context_negative_change
  - context_forest_change
  - context_crop_change
  - context_erosion
  - context_ldi
  - flood_events
  - landslide_events
  - flood_probability
  {% endverbatim %}{% elif hazard == "landslide" %}{% verbatim %}
  - popatrisk
  - context_mean_change
  - context_positive_change
  - context_negative_change
  - context_forest_change
  - context_crop_change
  - context_erosion
  - context_ldi
  - flood_events
  - landslide_events
  - flood_probability
  {% endverbatim %}{% endif %}
  - wlddsi_fot02d3
  - landscan
  - vam
  - nrt_1day
  - nrt_2day
  - nrt_3day
  - mapbox.light
  - mapbox.dark
  - osm
  - osm_humanitarian
{% endblock %}

{% block charts %}{% endblock %}

{% block controls %}
controls:
  attribution: false
  breadcrumbs: true
  calendar: true
  filters: true
  legend: true
  sidebar: true
  zoom: false
{% endblock %}

{% block navbars %}{% verbatim %}
navbars:
  - id: sparc-map-calendar
    placement: bottom
    page: "countryhazardmonthdetail"
    intents:
      - name: stateChanged
        properties:
          - { name: month, value: "{{ tab.value }}" }
    switch: "state.month"  # if tab.value = extract(selected, $scope)
    tabs:
      - { title: Jan, value: 1 }
      - { title: Feb, value: 2 }
      - { title: Mar, value: 3 }
      - { title: Apr, value: 4 }
      - { title: May, value: 5 }
      - { title: Jun, value: 6 }
      - { title: Jul, value: 7 }
      - { title: Aug, value: 8 }
      - { title: Sep, value: 9 }
      - { title: Oct, value: 10 }
      - { title: Nov, value: 11 }
      - { title: Dec, value: 12 }
{% endverbatim %}{% endblock %}

{% block sidebar %}
sidebar:
  ui:
    mainClass: ""
    tabs:
      #- { label: Welcome, target: geodash-sidebar-left-welcome }
      - { label: Charts, target: geodash-sidebar-left-charts }
      - { label: Layers, target: geodash-sidebar-left-layers }
      - { label: Filters, target: geodash-sidebar-left-filters }
    header:
      logo:
        src: /static/wfp/assets/logos/light/png/2x/en-emblem.png
        alt: wfp_logo
      title: SPARC
      subtitle: Spatial Risk Calendar
    layers:
      {% if hazard == "cyclone" %}{% verbatim %}
      - popatrisk
      - context_mean_change
      - context_positive_change
      - context_negative_change
      - context_forest_change
      - context_crop_change
      - context_erosion
      - context_ldi
      #- landscan
      #- vam_fcs
      #- vam_csi
      - cyclone_probability
      - cyclone_events
      {% endverbatim %}{% elif hazard == "drought" %}{% verbatim %}
      - popatrisk
      - wlddsi_fot02d3
      - context_mean_change
      - context_positive_change
      - context_negative_change
      - context_forest_change
      - context_crop_change
      - context_erosion
      - context_ldi
      #- landscan
      #- vam_fcs
      #- vam_csi
      {% endverbatim %}{% elif hazard == "flood" %}{% verbatim %}
      - popatrisk
      - context_mean_change
      - context_positive_change
      - context_negative_change
      - context_forest_change
      - context_crop_change
      - context_erosion
      - context_ldi
      #- landscan
      #- vam_fcs
      #- vam_csi
      - flood_events
      - landslide_events
      - flood_probability
      {% endverbatim %}{% elif hazard == "landslide" %}{% verbatim %}
      - popatrisk
      - context_mean_change
      - context_positive_change
      - context_negative_change
      - context_forest_change
      - context_crop_change
      - context_erosion
      - context_ldi
      #- landscan
      #- vam_fcs
      #- vam_csi
      - flood_events
      - landslide_events
      - flood_probability
      {% endverbatim %}{% endif %}
      - forecast_1day
      - forecast_3day
      - forecast_6day
      #- wld_poi_facilities_wfp
      #- wld_trs_supplyroutes_wfp
      - nrt_1day
      - nrt_2day
      - nrt_3day
      - mapbox.light
      - mapbox.dark
      - osm_humanitarian
      - osm
    groups:
      - id: natural_hazard
        label: Natural Hazards
        class: geodash-sidebar-layers-natural-hazards
        layers: [flood_probability, cyclone_probability, popatrisk, cyclone_events, flood_events, landslide_events, wlddsi_fot02d3]
      - id: context_factors
        label: Land Degradation
        class: geodash-sidebar-layers-context-factors
        layers:
          - context_mean_change
          - context_positive_change
          - context_negative_change
          - context_forest_change
          - context_crop_change
          - context_erosion
          - context_ldi
      #- id: vulnerability_factors
      #  label: Vulnerability Factors
      #  class: geodash-sidebar-layers-vulnerability-factors
      #  layers:
      #    - vam_fcs
      #    - vam_csi
      #- id: population_distribution
      #  label: Population Distribution
      #  class: geodash-sidebar-layers-population-distribution
      #  layers: [landscan]
      #- id: wfp_operations
      #  label: WFP Operations
      #  class: geodash-sidebar-layers-wfpoperations
      #  layers: [wld_poi_facilities_wfp, wld_trs_supplyroutes_wfp]
      - id: accumulated rainfall
        label: Near-Real-Time Precipitation
        class: geodash-sidebar-wfplayers
        layers: [nrt_1day, nrt_2day, nrt_3day]
      - id: forecast_precipitation
        label: Forecast Precipitation
        class: geodash-sidebar-forecast
        layers:
          - forecast_1day
          - forecast_3day
          - forecast_6day
    charts:
      - id: "popatrisk"
        element: "sparc-chart-popatrisk"
        type: "bar"
        {% if hazard == "flood" %}
        title: "**Population at Risk of Floods by Month for {{ country_title }}**\n(RP = Return Period)"
        description: "The chart above displays the number of people living in <font color='#ff5252'>**flood-prone**</font> areas, who may potentially be exposed to flood per month. The different colours indicate the probability expressed as or <font color='#ff5252'>**“return period” (rp)**</font> of those people being affected. The darker the shade, the more likely that they will be affected, as shown below.\n- <font color='#ff5252'>**Rp25**</font>: 1 event in 25 years; Probability of occurrence in any given year (4% chance).\n- <font color='#ff5252'>**Rp100**</font>: 1 event in 100 years; Probability of occurrence in any given year (1% chance)\n- <font color='#ff5252'>**Rp1000**</font>: 1 event in 1000 years; Probability of occurrence in any given year (0.1% chance)\n\nThese recurrence intervals give the estimated time interval between events of a similar size or intensity, and the greater the magnitude of the flood event the less chance of occurrence and viceversa.  You can choose to display only certain levels of probability by toggling the interactive legend under the chart: click on a probability class once to turn it off, click it again to turn it back on."
        tooltip: { name: flood_name, value: flood_value }
        {% elif hazard == "drought" %}
        title: "**Population at Risk by Month for {{ country_title }}**"
        description: "The chart above displays the number of people living in `{{ hazard }}-prone areas`, who may potentially be exposed to `{{ hazard }}` per month. The different colours indicate the probability of those people being affected; the darker the shade, the more likely that they will be affected as shown below.\n- 1 - 5% Less than 1 event every 20 years.\n- 5 - 10% Between 1 event every 20 years to 1 event every 10 years.\n- 10 - 20% Between 1 event every 10 years to 1 event every 5 years.\n- 20 - 100% More than 1 event every 5 years.\n\nYou can choose to display only certain levels of probability by toggling the interactive legend under the chart: click on a probability class once to turn it off, click it again to turn it back on."
        tooltip: { name: flood_name, value: {{ hazard }}_value }
        {% elif hazard == "cyclone" %}
        title: "**Population at Risk by Month for {{ country_title }}**"
        description: "The chart above displays the number of people living in `{{ hazard }}-prone areas`, who may potentially be exposed to `{{ hazard }}` per month. The different colours indicate the probability of those people being affected; the darker the shade, the more likely that they will be affected as shown below.\n- 1 - 10% Less than 1 event every 20 years.\n- 10 - 20% Between 1 event every 20 years to 1 event every 18 years.\n- 20 - 30% Between 1 event every 18 years to 1 event every 16 years.\n- 30 - 40% Between 1 event every 16 years to 1 event every 14 years.\n- 40 - 50% Between 1 event every 14 years to 1 event every 12 years.\n- 50 - 60% Between 1 event every 12 years to 1 event every 10 years.\n- 60 - 70% Between 1 event every 10 years to 1 event every 8 years.\n- 70 - 80% Between 1 event every 8 years to 1 event every 6 years.\n- 80 - 90% Between 1 event every 6 years to 1 event every 4 years.\n- 90 - 100% More than 1 event every 4 years.\n\nYou can choose to display only certain levels of probability by toggling the interactive legend under the chart: click on a probability class once to turn it off, click it again to turn it back on."
        tooltip: { name: flood_name, value: {{ hazard }}_value }
        {% else %}
        title: "**Population at Risk by Month for {{ country_title }}**"
        description: "The chart above displays the number of people living in `{{ hazard }}-prone areas`, who may potentially be exposed to `{{ hazard }}` per month. The different colours indicate the probability of those people being affected; the darker the shade, the more likely that they will be affected. You can choose to display only certain levels of probability by toggling the interactive legend under the chart: click on a probability class once to turn it off, click it again to turn it back on."
        tooltip: { name: flood_name, value: {{ hazard }}_value }
        {% endif %}
        axis:
          x:
            type: "months"
          y:
            label:
              text: 'Population at Risk'
              position: 'outer-middle'
        {% if hazard == "cyclone" %}{% verbatim %}
        hazard: cyclone
        colors: # Done!
          0-10%: "#00a878"
          10-20%: "#61b374"
          20-30%: "#8ebe6f"
          30-40%: "#b4c96a"
          40-50%: "#d9d364"
          50-60%: "#ffc45b"
          60-70%: "#ffac59"
          70-80%: "#ff9257"
          80-90%: "#ff7655"
          90-100%: "#ff5252"
        {% endverbatim %}{% elif hazard == "drought" %}{% verbatim %}
        hazard: drought
        colors: # Done!
          1-5%: "#fcdc5d"
          5-10%: "#ffb45a"
          10-20%: "#ff8856"
          20-100%: "#ff5252"
        {% endverbatim %}{% elif hazard == "flood" %}{% verbatim %}
        hazard: flood
        subtype: "bullet"
        colors:
          rp25: "#0370dd"
          rp100: "#2A93fc"
          rp1000: "#86C2fd"
        group_prefix: "rp"
        group_key: "rp"
        group_modifier: 1
        groups: [25, 100, 1000]
        {% endverbatim %}{% elif hazard == "landslide" %}{% verbatim %}
        hazard: landslide
        colors:
          low: "#fcdc5d"
          medium: "#ffb45a"
          high: "#ff8856"
          very_high: "#ff5252"
        {% endverbatim %}{% endif %}
{% endblock %}
